!function(){function e(e){return e.replace(/^\s+/g,"")}function t(e){return e.replace(/\s+$/g,"")}function r(r,i,n,a){function x(){function r(e){var t="",r=function(r){var i=t+r.toLowerCase();t=i.length<=e.length?i:i.substr(i.length-e.length,e.length)},i=function(){return-1===t.indexOf(e)};return{add:r,doesNotMatch:i}}return this.pos=0,this.token="",this.current_mode="CONTENT",this.tags={parent:"parent1",parentcount:1,parent1:""},this.tag_type="",this.token_text=this.last_token=this.last_text=this.token_type="",this.newlines=0,this.indent_content=o,this.indent_body_inner_html=f,this.indent_head_inner_html=u,this.Utils={whitespace:"\n\r	 ".split(""),single_token:["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr","!doctype","?xml","?php","basefont","isindex"],extra_liners:y,in_array:function(e,t){for(var r=0;r<t.length;r++)if(e===t[r])return!0;return!1}},this.is_whitespace=function(e){for(var t=0;t<e.length;t++)if(!this.Utils.in_array(e.charAt(t),this.Utils.whitespace))return!1;return!0},this.traverse_whitespace=function(){var e="";if(e=this.input.charAt(this.pos),this.Utils.in_array(e,this.Utils.whitespace)){for(this.newlines=0;this.Utils.in_array(e,this.Utils.whitespace);)v&&"\n"===e&&this.newlines<=_&&(this.newlines+=1),this.pos++,e=this.input.charAt(this.pos);return!0}return!1},this.space_or_wrap=function(e){return this.line_char_count>=this.wrap_line_length?(this.print_newline(!1,e),this.print_indentation(e),!0):(this.line_char_count++,e.push(" "),!1)},this.get_content=function(){for(var e="",t=[];"<"!==this.input.charAt(this.pos);){if(this.pos>=this.input.length)return t.length?t.join(""):["","TK_EOF"];if(this.traverse_whitespace())this.space_or_wrap(t);else{if(m){var r=this.input.substr(this.pos,3);if("{{#"===r||"{{/"===r)break;if("{{!"===r)return[this.get_tag(),"TK_TAG_HANDLEBARS_COMMENT"];if("{{"===this.input.substr(this.pos,2)&&"{{else}}"===this.get_tag(!0))break}e=this.input.charAt(this.pos),this.pos++,this.line_char_count++,t.push(e)}}return t.length?t.join(""):""},this.get_contents_to=function(e){if(this.pos===this.input.length)return["","TK_EOF"];var t="",r=new RegExp("</"+e+"\\s*>","igm");r.lastIndex=this.pos;var i=r.exec(this.input),n=i?i.index:this.input.length;return this.pos<n&&(t=this.input.substring(this.pos,n),this.pos=n),t},this.record_tag=function(e){this.tags[e+"count"]?(this.tags[e+"count"]++,this.tags[e+this.tags[e+"count"]]=this.indent_level):(this.tags[e+"count"]=1,this.tags[e+this.tags[e+"count"]]=this.indent_level),this.tags[e+this.tags[e+"count"]+"parent"]=this.tags.parent,this.tags.parent=e+this.tags[e+"count"]},this.retrieve_tag=function(e){if(this.tags[e+"count"]){for(var t=this.tags.parent;t&&e+this.tags[e+"count"]!==t;)t=this.tags[t+"parent"];t&&(this.indent_level=this.tags[e+this.tags[e+"count"]],this.tags.parent=this.tags[t+"parent"]),delete this.tags[e+this.tags[e+"count"]+"parent"],delete this.tags[e+this.tags[e+"count"]],1===this.tags[e+"count"]?delete this.tags[e+"count"]:this.tags[e+"count"]--}},this.indent_to_tag=function(e){if(this.tags[e+"count"]){for(var t=this.tags.parent;t&&e+this.tags[e+"count"]!==t;)t=this.tags[t+"parent"];t&&(this.indent_level=this.tags[e+this.tags[e+"count"]])}},this.get_tag=function(e){var s,o,f,t="",r=[],i="",n=!1,a=!0,u=this.pos,l=this.line_char_count;e=void 0!==e?e:!1;do{if(this.pos>=this.input.length)return e&&(this.pos=u,this.line_char_count=l),r.length?r.join(""):["","TK_EOF"];if(t=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(t,this.Utils.whitespace))n=!0;else{if(("'"===t||'"'===t)&&(t+=this.get_unformatted(t),n=!0),"="===t&&(n=!1),r.length&&"="!==r[r.length-1]&&">"!==t&&n){var c=this.space_or_wrap(r),d=c&&"/"!==t&&"force"!==g;if(n=!1,a||"force"!==g||"/"===t||(this.print_newline(!1,r),this.print_indentation(r),d=!0),d)for(var v=0;w>v;v++)r.push(h);for(var _=0;_<r.length;_++)if(" "===r[_]){a=!1;break}}if(m&&"<"===f&&t+this.input.charAt(this.pos)==="{{"&&(t+=this.get_unformatted("}}"),r.length&&" "!==r[r.length-1]&&"<"!==r[r.length-1]&&(t=" "+t),n=!0),"<"!==t||f||(s=this.pos-1,f="<"),m&&!f&&r.length>=2&&"{"===r[r.length-1]&&"{"===r[r.length-2]&&(s="#"===t||"/"===t||"!"===t?this.pos-3:this.pos-2,f="{"),this.line_char_count++,r.push(t),r[1]&&("!"===r[1]||"?"===r[1]||"%"===r[1])){r=[this.get_comment(s)];break}if(m&&r[1]&&"{"===r[1]&&r[2]&&"!"===r[2]){r=[this.get_comment(s)];break}if(m&&"{"===f&&r.length>2&&"}"===r[r.length-2]&&"}"===r[r.length-1])break}}while(">"!==t);var y,k,b=r.join("");y=-1!==b.indexOf(" ")?b.indexOf(" "):"{"===b.charAt(0)?b.indexOf("}"):b.indexOf(">"),k="<"!==b.charAt(0)&&m?"#"===b.charAt(2)?3:2:1;var x=b.substring(k,y).toLowerCase();return"/"===b.charAt(b.length-2)||this.Utils.in_array(x,this.Utils.single_token)?e||(this.tag_type="SINGLE"):m&&"{"===b.charAt(0)&&"else"===x?e||(this.indent_to_tag("if"),this.tag_type="HANDLEBARS_ELSE",this.indent_content=!0,this.traverse_whitespace()):this.is_unformatted(x,p)?(i=this.get_unformatted("</"+x+">",b),r.push(i),o=this.pos-1,this.tag_type="SINGLE"):"script"===x&&(-1===b.search("type")||b.search("type")>-1&&b.search(/\b(text|application)\/(x-)?(javascript|ecmascript|jscript|livescript|(ld\+)?json)/)>-1)?e||(this.record_tag(x),this.tag_type="SCRIPT"):"style"===x&&(-1===b.search("type")||b.search("type")>-1&&b.search("text/css")>-1)?e||(this.record_tag(x),this.tag_type="STYLE"):"!"===x.charAt(0)?e||(this.tag_type="SINGLE",this.traverse_whitespace()):e||("/"===x.charAt(0)?(this.retrieve_tag(x.substring(1)),this.tag_type="END"):(this.record_tag(x),"html"!==x.toLowerCase()&&(this.indent_content=!0),this.tag_type="START"),this.traverse_whitespace()&&this.space_or_wrap(r),this.Utils.in_array(x,this.Utils.extra_liners)&&(this.print_newline(!1,this.output),this.output.length&&"\n"!==this.output[this.output.length-2]&&this.print_newline(!0,this.output))),e&&(this.pos=u,this.line_char_count=l),r.join("")},this.get_comment=function(e){var t="",r=">",i=!1;this.pos=e;var n=this.input.charAt(this.pos);for(this.pos++;this.pos<=this.input.length&&(t+=n,t.charAt(t.length-1)!==r.charAt(r.length-1)||-1===t.indexOf(r));)!i&&t.length<10&&(0===t.indexOf("<![if")?(r="<![endif]>",i=!0):0===t.indexOf("<![cdata[")?(r="]]>",i=!0):0===t.indexOf("<![")?(r="]>",i=!0):0===t.indexOf("<!--")?(r="-->",i=!0):0===t.indexOf("{{!")?(r="}}",i=!0):0===t.indexOf("<?")?(r="?>",i=!0):0===t.indexOf("<%")&&(r="%>",i=!0)),n=this.input.charAt(this.pos),this.pos++;return t},this.get_unformatted=function(e,t){if(t&&-1!==t.toLowerCase().indexOf(e))return"";var i="",n="",a=!0,s=r(e);do{if(this.pos>=this.input.length)return n;if(i=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(i,this.Utils.whitespace)){if(!a){this.line_char_count--;continue}if("\n"===i||"\r"===i){n+="\n",this.line_char_count=0;continue}}n+=i,s.add(i),this.line_char_count++,a=!0,m&&"{"===i&&n.length&&"{"===n.charAt(n.length-2)&&(n+=this.get_unformatted("}}"))}while(s.doesNotMatch());return n},this.get_token=function(){var e;if("TK_TAG_SCRIPT"===this.last_token||"TK_TAG_STYLE"===this.last_token){var t=this.last_token.substr(7);return e=this.get_contents_to(t),"string"!=typeof e?e:[e,"TK_"+t]}if("CONTENT"===this.current_mode)return e=this.get_content(),"string"!=typeof e?e:[e,"TK_CONTENT"];if("TAG"===this.current_mode){if(e=this.get_tag(),"string"!=typeof e)return e;var r="TK_TAG_"+this.tag_type;return[e,r]}},this.get_full_indent=function(e){return e=this.indent_level+e||0,1>e?"":Array(e+1).join(this.indent_string)},this.is_unformatted=function(e,t){if(!this.Utils.in_array(e,t))return!1;if("a"!==e.toLowerCase()||!this.Utils.in_array("a",t))return!0;var r=this.get_tag(!0),i=(r||"").match(/^\s*<\s*\/?([a-z]*)\s*[^>]*>\s*$/);return!i||this.Utils.in_array(i,t)?!0:!1},this.printer=function(r,i,n,a,s){this.input=r||"",this.input=this.input.replace(/\r\n|[\r\u2028\u2029]/g,"\n"),this.output=[],this.indent_character=i,this.indent_string="",this.indent_size=n,this.brace_style=s,this.indent_level=0,this.wrap_line_length=a,this.line_char_count=0;for(var o=0;o<this.indent_size;o++)this.indent_string+=this.indent_character;this.print_newline=function(e,r){this.line_char_count=0,r&&r.length&&(e||"\n"!==r[r.length-1])&&("\n"!==r[r.length-1]&&(r[r.length-1]=t(r[r.length-1])),r.push("\n"))},this.print_indentation=function(e){for(var t=0;t<this.indent_level;t++)e.push(this.indent_string),this.line_char_count+=this.indent_string.length},this.print_token=function(t){(!this.is_whitespace(t)||this.output.length)&&((t||""!==t)&&this.output.length&&"\n"===this.output[this.output.length-1]&&(this.print_indentation(this.output),t=e(t)),this.print_token_raw(t))},this.print_token_raw=function(e){this.newlines>0&&(e=t(e)),e&&""!==e&&(e.length>1&&"\n"===e.charAt(e.length-1)?(this.output.push(e.slice(0,-1)),this.print_newline(!1,this.output)):this.output.push(e));for(var r=0;r<this.newlines;r++)this.print_newline(r>0,this.output);this.newlines=0},this.indent=function(){this.indent_level++},this.unindent=function(){this.indent_level>0&&this.indent_level--}},this}var s,o,f,u,l,h,c,d,p,v,_,m,g,w,b,y,k;for(i=i||{},void 0!==i.wrap_line_length&&0!==parseInt(i.wrap_line_length,10)||void 0===i.max_char||0===parseInt(i.max_char,10)||(i.wrap_line_length=i.max_char),o=void 0===i.indent_inner_html?!1:i.indent_inner_html,f=void 0===i.indent_body_inner_html?!0:i.indent_body_inner_html,u=void 0===i.indent_head_inner_html?!0:i.indent_head_inner_html,l=void 0===i.indent_size?4:parseInt(i.indent_size,10),h=void 0===i.indent_char?" ":i.indent_char,d=void 0===i.brace_style?"collapse":i.brace_style,c=0===parseInt(i.wrap_line_length,10)?32786:parseInt(i.wrap_line_length||250,10),p=i.unformatted||["a","abbr","area","audio","b","bdi","bdo","br","button","canvas","cite","code","data","datalist","del","dfn","em","embed","i","iframe","img","input","ins","kbd","keygen","label","map","mark","math","meter","noscript","object","output","progress","q","ruby","s","samp","select","small","span","strong","sub","sup","svg","template","textarea","time","u","var","video","wbr","text","acronym","address","big","dt","ins","small","strike","tt","pre","h1","h2","h3","h4","h5","h6"],v=void 0===i.preserve_newlines?!0:i.preserve_newlines,_=v?isNaN(parseInt(i.max_preserve_newlines,10))?32786:parseInt(i.max_preserve_newlines,10):0,m=void 0===i.indent_handlebars?!1:i.indent_handlebars,g=void 0===i.wrap_attributes?"auto":i.wrap_attributes,w=isNaN(parseInt(i.wrap_attributes_indent_size,10))?l:parseInt(i.wrap_attributes_indent_size,10),b=void 0===i.end_with_newline?!1:i.end_with_newline,y="object"==typeof i.extra_liners&&i.extra_liners?i.extra_liners.concat():"string"==typeof i.extra_liners?i.extra_liners.split(","):"head,body,/html".split(","),k=i.eol?i.eol:"\n",i.indent_with_tabs&&(h="	",l=1),k=k.replace(/\\r/,"\r").replace(/\\n/,"\n"),s=new x,s.printer(r,h,l,c,d);;){var S=s.get_token();if(s.token_text=S[0],s.token_type=S[1],"TK_EOF"===s.token_type)break;switch(s.token_type){case"TK_TAG_START":s.print_newline(!1,s.output),s.print_token(s.token_text),s.indent_content&&(!s.indent_body_inner_html&&s.token_text.match(/<body(?:.*)>/)||!s.indent_head_inner_html&&s.token_text.match(/<head(?:.*)>/)||s.indent(),s.indent_content=!1),s.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":s.print_newline(!1,s.output),s.print_token(s.token_text),s.current_mode="CONTENT";break;case"TK_TAG_END":if("TK_CONTENT"===s.last_token&&""===s.last_text){var A=(s.token_text.match(/\w+/)||[])[0],E=null;s.output.length&&(E=s.output[s.output.length-1].match(/(?:<|{{#)\s*(\w+)/)),(null===E||E[1]!==A&&!s.Utils.in_array(E[1],p))&&s.print_newline(!1,s.output)}s.print_token(s.token_text),s.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var z=s.token_text.match(/^\s*<([a-z-]+)/i);z&&s.Utils.in_array(z[1],p)||s.print_newline(!1,s.output),s.print_token(s.token_text),s.current_mode="CONTENT";break;case"TK_TAG_HANDLEBARS_ELSE":for(var C=!1,T=s.output.length-1;T>=0&&"\n"!==s.output[T];T--)if(s.output[T].match(/{{#if/)){C=!0;break}C||s.print_newline(!1,s.output),s.print_token(s.token_text),s.indent_content&&(s.indent(),s.indent_content=!1),s.current_mode="CONTENT";break;case"TK_TAG_HANDLEBARS_COMMENT":s.print_token(s.token_text),s.current_mode="TAG";break;case"TK_CONTENT":s.print_token(s.token_text),s.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":if(""!==s.token_text){s.print_newline(!1,s.output);var I,O=s.token_text,R=1;"TK_SCRIPT"===s.token_type?I="function"==typeof n&&n:"TK_STYLE"===s.token_type&&(I="function"==typeof a&&a),"keep"===i.indent_scripts?R=0:"separate"===i.indent_scripts&&(R=-s.indent_level);var B=s.get_full_indent(R);if(I){var N=function(){this.eol="\n"};N.prototype=i;var D=new N;O=I(O.replace(/^\s*/,B),D)}else{var U=O.match(/^\s*/)[0],L=U.match(/[^\n\r]*$/)[0].split(s.indent_string).length-1,F=s.get_full_indent(R-L);O=O.replace(/^\s*/,B).replace(/\r\n|\r|\n/g,"\n"+F).replace(/\s+$/,"")}O&&(s.print_token_raw(O),s.print_newline(!0,s.output))}s.current_mode="TAG";break;default:""!==s.token_text&&s.print_token(s.token_text)}s.last_token=s.token_type,s.last_text=s.token_text}var P=s.output.join("").replace(/[\r\n\t ]+$/,"");return b&&(P+="\n"),"\n"!==k&&(P=P.replace(/[\n]/g,k)),P}if("function"==typeof define&&define.amd)define(["require","./beautify","./beautify-css"],function(e){var t=e("./beautify"),i=e("./beautify-css");return{html_beautify:function(e,n){return r(e,n,t.js_beautify,i.css_beautify)}}});else if("undefined"!=typeof exports){var i=require("./beautify.js"),n=require("./beautify-css.js");exports.html_beautify=function(e,t){return r(e,t,i.js_beautify,n.css_beautify)}}else"undefined"!=typeof window?window.html_beautify=function(e,t){return r(e,t,window.js_beautify,window.css_beautify)}:"undefined"!=typeof global&&(global.html_beautify=function(e,t){return r(e,t,global.js_beautify,global.css_beautify)})}();
